{"version":3,"sources":["readmore.js"],"names":["factory","define","amd","exports","module","require","jQuery","$","debounce","func","wait","immediate","timeout","context","this","args","arguments","later","apply","callNow","clearTimeout","setTimeout","uniqueId","prefix","id","uniqueIdCounter","String","setBoxHeights","element","el","clone","css","height","width","maxHeight","overflow","insertAfter","expandedHeight","outerHeight","cssMaxHeight","parseInt","replace","defaultHeight","data","remove","collapsedHeight","embedCSS","options","cssEmbedded","selector","styles","blockCSS","speed","d","u","createElement","type","styleSheet","cssText","appendChild","createTextNode","getElementsByTagName","document","Readmore","extend","defaults","_defaults","_name","readmore","init","window","addEventListener","resizeBoxes","attachEvent","heightMargin","moreLink","lessLink","startOpen","blockProcessed","beforeToggle","afterToggle","each","current","isExpanded","attr","prototype","useLink","data-readmore","aria-expanded","after","on","_this","event","toggle","data-readmore-toggle","aria-controls","trigger","preventDefault","$element","newHeight","newLink","expanded","off","replaceWith","destroy","next","removeData","fn","instance","Array","slice","call"],"mappings":"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","file":"readmore.min.js","sourcesContent":["/*!\n * @preserve\n *\n * Readmore.js jQuery plugin\n * Author: @jed_foster\n * Project home: http://jedfoster.github.io/Readmore.js\n * Licensed under the MIT license\n *\n * Debounce function from http://davidwalsh.name/javascript-debounce-function\n */\n\n/* global jQuery */\n\n(function(factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // CommonJS\n    module.exports = factory(require('jquery'));\n  } else {\n    // Browser globals\n    factory(jQuery);\n  }\n}(function($) {\n  'use strict';\n\n  var readmore = 'readmore',\n      defaults = {\n        speed: 100,\n        collapsedHeight: 200,\n        heightMargin: 16,\n        moreLink: '<a href=\"#\">Read More</a>',\n        lessLink: '<a href=\"#\">Close</a>',\n        embedCSS: true,\n        blockCSS: 'display: block; width: 100%;',\n        startOpen: false,\n\n        // callbacks\n        blockProcessed: function() {},\n        beforeToggle: function() {},\n        afterToggle: function() {}\n      },\n      cssEmbedded = {},\n      uniqueIdCounter = 0;\n\n  function debounce(func, wait, immediate) {\n    var timeout;\n\n    return function() {\n      var context = this, args = arguments;\n      var later = function() {\n        timeout = null;\n        if (! immediate) {\n          func.apply(context, args);\n        }\n      };\n      var callNow = immediate && !timeout;\n\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n\n      if (callNow) {\n        func.apply(context, args);\n      }\n    };\n  }\n\n  function uniqueId(prefix) {\n    var id = ++uniqueIdCounter;\n\n    return String(prefix == null ? 'rmjs-' : prefix) + id;\n  }\n\n  function setBoxHeights(element) {\n    var el = element.clone().css({\n          height: 'auto',\n          width: element.width(),\n          maxHeight: 'none',\n          overflow: 'hidden'\n        }).insertAfter(element),\n        expandedHeight = el.outerHeight(),\n        cssMaxHeight = parseInt(el.css({maxHeight: ''}).css('max-height').replace(/[^-\\d\\.]/g, ''), 10),\n        defaultHeight = element.data('defaultHeight');\n\n    el.remove();\n\n    var collapsedHeight = cssMaxHeight || element.data('collapsedHeight') || defaultHeight;\n\n    // Store our measurements.\n    element.data({\n      expandedHeight: expandedHeight,\n      maxHeight: cssMaxHeight,\n      collapsedHeight: collapsedHeight\n    })\n    // and disable any `max-height` property set in CSS\n    .css({\n      maxHeight: 'none'\n    });\n  }\n\n  var resizeBoxes = debounce(function() {\n    $('[data-readmore]').each(function() {\n      var current = $(this),\n          isExpanded = (current.attr('aria-expanded') === 'true');\n\n      setBoxHeights(current);\n\n      current.css({\n        height: current.data( (isExpanded ? 'expandedHeight' : 'collapsedHeight') )\n      });\n    });\n  }, 100);\n\n  function embedCSS(options) {\n    if (! cssEmbedded[options.selector]) {\n      var styles = ' ';\n\n      if (options.embedCSS && options.blockCSS !== '') {\n        styles += options.selector + ' + [data-readmore-toggle], ' +\n          options.selector + '[data-readmore]{' +\n            options.blockCSS +\n          '}';\n      }\n\n      // Include the transition CSS even if embedCSS is false\n      styles += options.selector + '[data-readmore]{' +\n        'transition: height ' + options.speed + 'ms;' +\n        'overflow: hidden;' +\n      '}';\n\n      (function(d, u) {\n        var css = d.createElement('style');\n        css.type = 'text/css';\n\n        if (css.styleSheet) {\n          css.styleSheet.cssText = u;\n        }\n        else {\n          css.appendChild(d.createTextNode(u));\n        }\n\n        d.getElementsByTagName('head')[0].appendChild(css);\n      }(document, styles));\n\n      cssEmbedded[options.selector] = true;\n    }\n  }\n\n  function Readmore(element, options) {\n    this.element = element;\n\n    this.options = $.extend({}, defaults, options);\n\n    embedCSS(this.options);\n\n    this._defaults = defaults;\n    this._name = readmore;\n\n    this.init();\n\n    // IE8 chokes on `window.addEventListener`, so need to test for support.\n    if (window.addEventListener) {\n      // Need to resize boxes when the page has fully loaded.\n      window.addEventListener('load', resizeBoxes);\n      window.addEventListener('resize', resizeBoxes);\n    }\n    else {\n      window.attachEvent('load', resizeBoxes);\n      window.attachEvent('resize', resizeBoxes);\n    }\n  }\n\n\n  Readmore.prototype = {\n    init: function() {\n      var current = $(this.element);\n\n      current.data({\n        defaultHeight: this.options.collapsedHeight,\n        heightMargin: this.options.heightMargin\n      });\n\n      setBoxHeights(current);\n\n      var collapsedHeight = current.data('collapsedHeight'),\n          heightMargin = current.data('heightMargin');\n\n      if (current.outerHeight(true) <= collapsedHeight + heightMargin) {\n        // The block is shorter than the limit, so there's no need to truncate it.\n        if (this.options.blockProcessed && typeof this.options.blockProcessed === 'function') {\n          this.options.blockProcessed(current, false);\n        }\n        return true;\n      }\n      else {\n        var id = current.attr('id') || uniqueId(),\n            useLink = this.options.startOpen ? this.options.lessLink : this.options.moreLink;\n\n        current.attr({\n          'data-readmore': '',\n          'aria-expanded': this.options.startOpen,\n          'id': id\n        });\n\n        current.after($(useLink)\n          .on('click', (function(_this) {\n            return function(event) {\n              _this.toggle(this, current[0], event);\n            };\n          })(this))\n          .attr({\n            'data-readmore-toggle': id,\n            'aria-controls': id\n          }));\n\n        if (! this.options.startOpen) {\n          current.css({\n            height: collapsedHeight\n          });\n        }\n\n        if (this.options.blockProcessed && typeof this.options.blockProcessed === 'function') {\n          this.options.blockProcessed(current, true);\n        }\n      }\n    },\n\n    toggle: function(trigger, element, event) {\n      if (event) {\n        event.preventDefault();\n      }\n\n      if (! trigger) {\n        trigger = $('[aria-controls=\"' + this.element.id + '\"]')[0];\n      }\n\n      if (! element) {\n        element = this.element;\n      }\n\n      var $element = $(element),\n          newHeight = '',\n          newLink = '',\n          expanded = false,\n          collapsedHeight = $element.data('collapsedHeight');\n\n      if ($element.height() <= collapsedHeight) {\n        newHeight = $element.data('expandedHeight') + 'px';\n        newLink = 'lessLink';\n        expanded = true;\n      }\n      else {\n        newHeight = collapsedHeight;\n        newLink = 'moreLink';\n      }\n\n      // Fire beforeToggle callback\n      // Since we determined the new \"expanded\" state above we're now out of sync\n      // with our true current state, so we need to flip the value of `expanded`\n      if (this.options.beforeToggle && typeof this.options.beforeToggle === 'function') {\n        this.options.beforeToggle(trigger, $element, ! expanded);\n      }\n\n      $element.css({'height': newHeight});\n\n      // Fire afterToggle callback\n      $element.on('transitionend', (function(_this) {\n        return function() {\n          if (_this.options.afterToggle && typeof _this.options.afterToggle === 'function') {\n            _this.options.afterToggle(trigger, $element, expanded);\n          }\n\n          $(this).attr({\n            'aria-expanded': expanded\n          }).off('transitionend');\n        }\n      })(this));\n\n      $(trigger).replaceWith($(this.options[newLink])\n        .on('click', (function(_this) {\n            return function(event) {\n              _this.toggle(this, element, event);\n            };\n          })(this))\n        .attr({\n          'data-readmore-toggle': $element.attr('id'),\n          'aria-controls': $element.attr('id')\n        }));\n    },\n\n    destroy: function() {\n      $(this.element).each(function() {\n        var current = $(this);\n\n        current.attr({\n          'data-readmore': null,\n          'aria-expanded': null\n        })\n          .css({\n            maxHeight: '',\n            height: ''\n          })\n          .next('[data-readmore-toggle]')\n          .remove();\n\n        current.removeData();\n      });\n    }\n  };\n\n\n  $.fn.readmore = function(options) {\n    var args = arguments,\n        selector = this.selector;\n\n    options = options || {};\n\n    if (typeof options === 'object') {\n      return this.each(function() {\n        if ($.data(this, 'plugin_' + readmore)) {\n          var instance = $.data(this, 'plugin_' + readmore);\n          instance.destroy.apply(instance);\n        }\n\n        options.selector = selector;\n\n        $.data(this, 'plugin_' + readmore, new Readmore(this, options));\n      });\n    }\n    else if (typeof options === 'string' && options[0] !== '_' && options !== 'init') {\n      return this.each(function () {\n        var instance = $.data(this, 'plugin_' + readmore);\n        if (instance instanceof Readmore && typeof instance[options] === 'function') {\n          instance[options].apply(instance, Array.prototype.slice.call(args, 1));\n        }\n      });\n    }\n  };\n\n}));\n\n"]}