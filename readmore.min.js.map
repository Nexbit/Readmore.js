{"version":3,"sources":["readmore.js"],"names":["factory","define","amd","exports","module","require","jQuery","$","readmore","defaults","speed","collapsedHeight","heightMargin","moreLink","lessLink","embedCSS","blockCSS","startOpen","blockProcessed","beforeToggle","afterToggle","cssEmbedded","uniqueIdCounter","setBoxHeights","element","el","clone","css","height","width","maxHeight","overflow","insertAfter","expandedHeight","outerHeight","cssMaxHeight","parseInt","replace","defaultHeight","data","remove","func","wait","immediate","timeout","resizeBoxes","each","current","this","isExpanded","attr","context","args","arguments","callNow","clearTimeout","setTimeout","apply","Readmore","options","extend","selector","styles","d","document","u","createElement","type","styleSheet","cssText","appendChild","createTextNode","getElementsByTagName","_defaults","_name","init","window","addEventListener","attachEvent","prototype","_this","prefix","id","String","useLink","data-readmore","aria-expanded","after","on","event","toggle","data-readmore-toggle","aria-controls","trigger","preventDefault","$element","newHeight","newLink","expanded","off","replaceWith","destroy","next","removeData","fn","instance","Array","slice","call"],"mappings":"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","file":"readmore.min.js","sourcesContent":["/*!\n * @preserve\n *\n * Readmore.js jQuery plugin\n * Author: @jed_foster\n * Project home: http://jedfoster.github.io/Readmore.js\n * Licensed under the MIT license\n *\n * Debounce function from http://davidwalsh.name/javascript-debounce-function\n */\n\n/* global jQuery */\n\n(function(factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // CommonJS\n    module.exports = factory(require('jquery'));\n  } else {\n    // Browser globals\n    factory(jQuery);\n  }\n}(function($) {\n  'use strict';\n\n  var readmore = 'readmore',\n      defaults = {\n        speed: 100,\n        collapsedHeight: 200,\n        heightMargin: 16,\n        moreLink: '<a href=\"#\">Read More</a>',\n        lessLink: '<a href=\"#\">Close</a>',\n        embedCSS: true,\n        blockCSS: 'display: block; width: 100%;',\n        startOpen: false,\n\n        // callbacks\n        blockProcessed: function() {},\n        beforeToggle: function() {},\n        afterToggle: function() {}\n      },\n      cssEmbedded = {},\n      uniqueIdCounter = 0;\n\n  function debounce(func, wait, immediate) {\n    var timeout;\n\n    return function() {\n      var context = this, args = arguments;\n      var later = function() {\n        timeout = null;\n        if (! immediate) {\n          func.apply(context, args);\n        }\n      };\n      var callNow = immediate && !timeout;\n\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n\n      if (callNow) {\n        func.apply(context, args);\n      }\n    };\n  }\n\n  function uniqueId(prefix) {\n    var id = ++uniqueIdCounter;\n\n    return String(prefix == null ? 'rmjs-' : prefix) + id;\n  }\n\n  function setBoxHeights(element) {\n    var el = element.clone().css({\n          height: 'auto',\n          width: element.width(),\n          maxHeight: 'none',\n          overflow: 'hidden'\n        }).insertAfter(element),\n        expandedHeight = el.outerHeight(),\n        cssMaxHeight = parseInt(el.css({maxHeight: ''}).css('max-height').replace(/[^-\\d\\.]/g, ''), 10),\n        defaultHeight = element.data('defaultHeight');\n\n    el.remove();\n\n    var collapsedHeight = cssMaxHeight || element.data('collapsedHeight') || defaultHeight;\n\n    // Store our measurements.\n    element.data({\n      expandedHeight: expandedHeight,\n      maxHeight: cssMaxHeight,\n      collapsedHeight: collapsedHeight\n    })\n    // and disable any `max-height` property set in CSS\n    .css({\n      maxHeight: 'none'\n    });\n  }\n\n  var resizeBoxes = debounce(function() {\n    $('[data-readmore]').each(function() {\n      var current = $(this),\n          isExpanded = (current.attr('aria-expanded') === 'true');\n\n      setBoxHeights(current);\n\n      current.css({\n        height: current.data( (isExpanded ? 'expandedHeight' : 'collapsedHeight') )\n      });\n    });\n  }, 100);\n\n  function embedCSS(options) {\n    if (! cssEmbedded[options.selector]) {\n      var styles = ' ';\n\n      if (options.embedCSS && options.blockCSS !== '') {\n        styles += options.selector + ' + [data-readmore-toggle], ' +\n          options.selector + '[data-readmore]{' +\n            options.blockCSS +\n          '}';\n      }\n\n      // Include the transition CSS even if embedCSS is false\n      styles += options.selector + '[data-readmore]{' +\n        'transition: height ' + options.speed + 'ms;' +\n        'overflow: hidden;' +\n      '}';\n\n      (function(d, u) {\n        var css = d.createElement('style');\n        css.type = 'text/css';\n\n        if (css.styleSheet) {\n          css.styleSheet.cssText = u;\n        }\n        else {\n          css.appendChild(d.createTextNode(u));\n        }\n\n        d.getElementsByTagName('head')[0].appendChild(css);\n      }(document, styles));\n\n      cssEmbedded[options.selector] = true;\n    }\n  }\n\n  function Readmore(element, options) {\n    this.element = element;\n\n    this.options = $.extend({}, defaults, options);\n\n    embedCSS(this.options);\n\n    this._defaults = defaults;\n    this._name = readmore;\n\n    this.init();\n\n    // IE8 chokes on `window.addEventListener`, so need to test for support.\n    if (window.addEventListener) {\n      // Need to resize boxes when the page has fully loaded.\n      window.addEventListener('load', resizeBoxes);\n      window.addEventListener('resize', resizeBoxes);\n    }\n    else {\n      window.attachEvent('load', resizeBoxes);\n      window.attachEvent('resize', resizeBoxes);\n    }\n  }\n\n\n  Readmore.prototype = {\n    init: function() {\n      var current = $(this.element);\n\n      current.data({\n        defaultHeight: this.options.collapsedHeight,\n        heightMargin: this.options.heightMargin\n      });\n\n      setBoxHeights(current);\n\n      var collapsedHeight = current.data('collapsedHeight'),\n          heightMargin = current.data('heightMargin');\n\n      if (current.outerHeight(true) <= collapsedHeight + heightMargin) {\n        // The block is shorter than the limit, so there's no need to truncate it.\n        if (this.options.blockProcessed && typeof this.options.blockProcessed === 'function') {\n          this.options.blockProcessed(current, false);\n        }\n        return true;\n      }\n      else {\n        var id = current.attr('id') || uniqueId(),\n            useLink = this.options.startOpen ? this.options.lessLink : this.options.moreLink;\n\n        current.attr({\n          'data-readmore': '',\n          'aria-expanded': this.options.startOpen,\n          'id': id\n        });\n\n        current.after($(useLink)\n          .on('click', (function(_this) {\n            return function(event) {\n              _this.toggle(this, current[0], event);\n            };\n          })(this))\n          .attr({\n            'data-readmore-toggle': id,\n            'aria-controls': id\n          }));\n\n        if (! this.options.startOpen) {\n          current.css({\n            height: collapsedHeight\n          });\n        }\n\n        if (this.options.blockProcessed && typeof this.options.blockProcessed === 'function') {\n          this.options.blockProcessed(current, true);\n        }\n      }\n    },\n\n    toggle: function(trigger, element, event) {\n      if (event) {\n        event.preventDefault();\n      }\n\n      if (! trigger) {\n        trigger = $('[aria-controls=\"' + this.element.id + '\"]')[0];\n      }\n\n      if (! element) {\n        element = this.element;\n      }\n\n      var $element = $(element),\n          newHeight = '',\n          newLink = '',\n          expanded = false,\n          collapsedHeight = $element.data('collapsedHeight');\n\n      if ($element.height() <= collapsedHeight) {\n        newHeight = $element.data('expandedHeight') + 'px';\n        newLink = 'lessLink';\n        expanded = true;\n      }\n      else {\n        newHeight = collapsedHeight;\n        newLink = 'moreLink';\n      }\n\n      // Fire beforeToggle callback\n      // Since we determined the new \"expanded\" state above we're now out of sync\n      // with our true current state, so we need to flip the value of `expanded`\n      if (this.options.beforeToggle && typeof this.options.beforeToggle === 'function') {\n        this.options.beforeToggle(trigger, $element, ! expanded);\n      }\n\n      $element.css({'height': newHeight});\n\n      // Fire afterToggle callback\n      $element.on('transitionend', (function(_this) {\n        return function() {\n          if (_this.options.afterToggle && typeof _this.options.afterToggle === 'function') {\n            _this.options.afterToggle(trigger, $element, expanded);\n          }\n\n          $(this).attr({\n            'aria-expanded': expanded\n          }).off('transitionend');\n        }\n      })(this));\n\n      $(trigger).replaceWith($(this.options[newLink])\n        .on('click', (function(_this) {\n            return function(event) {\n              _this.toggle(this, element, event);\n            };\n          })(this))\n        .attr({\n          'data-readmore-toggle': $element.attr('id'),\n          'aria-controls': $element.attr('id')\n        }));\n    },\n\n    destroy: function() {\n      $(this.element).each(function() {\n        var current = $(this);\n\n        current.attr({\n          'data-readmore': null,\n          'aria-expanded': null\n        })\n          .css({\n            maxHeight: '',\n            height: ''\n          })\n          .next('[data-readmore-toggle]')\n          .remove();\n\n        current.removeData();\n      });\n    }\n  };\n\n\n  $.fn.readmore = function(options) {\n    var args = arguments,\n        selector = this.selector;\n\n    options = options || {};\n\n    if (typeof options === 'object') {\n      return this.each(function() {\n        if ($.data(this, 'plugin_' + readmore)) {\n          var instance = $.data(this, 'plugin_' + readmore);\n          instance.destroy.apply(instance);\n        }\n\n        options.selector = selector;\n\n        $.data(this, 'plugin_' + readmore, new Readmore(this, options));\n      });\n    }\n    else if (typeof options === 'string' && options[0] !== '_' && options !== 'init') {\n      return this.each(function () {\n        var instance = $.data(this, 'plugin_' + readmore);\n        if (instance instanceof Readmore && typeof instance[options] === 'function') {\n          instance[options].apply(instance, Array.prototype.slice.call(args, 1));\n        }\n      });\n    }\n  };\n\n}));\n\n"]}